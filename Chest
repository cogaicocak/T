-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Variables
local LocalPlayer = Players.LocalPlayer

local function getCharacter()
    if not LocalPlayer.Character then
        LocalPlayer.CharacterAdded:Wait()
    end
    LocalPlayer.Character:WaitForChild("HumanoidRootPart")
    return LocalPlayer.Character
end

-- Create GUI v·ªõi animation HO·∫†T ƒê·ªòNG 100%
local function createGui()
    -- X√≥a GUI c≈© n·∫øu c√≥
    local oldGui = LocalPlayer.PlayerGui:FindFirstChild("ChestFarmGUI")
    if oldGui then
        oldGui:Destroy()
    end
    
    local gui = Instance.new("ScreenGui")
    gui.Name = "ChestFarmGUI"
    gui.IgnoreGuiInset = true
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    gui.DisplayOrder = 999999
    gui.ResetOnSpawn = false
    gui.Parent = LocalPlayer.PlayerGui
    
    -- Background frame full screen
    local background = Instance.new("Frame")
    background.Name = "Background"
    background.Parent = gui
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BackgroundTransparency = 1 -- B·∫Øt ƒë·∫ßu trong su·ªët ho√†n to√†n
    background.Size = UDim2.new(1, 0, 1, 0)
    background.Position = UDim2.new(0, 0, 0, 0)
    background.BorderSizePixel = 0
    
    -- Container for centered content
    local container = Instance.new("Frame")
    container.Name = "Container"
    container.Parent = background
    container.Size = UDim2.new(0, 400, 0, 150)
    container.Position = UDim2.new(0.5, 0, 0.5, 0)
    container.AnchorPoint = Vector2.new(0.5, 0.5)
    container.BackgroundTransparency = 1
    
    -- Main text
    local mainText = Instance.new("TextLabel")
    mainText.Name = "MainText"
    mainText.Parent = container
    mainText.Size = UDim2.new(1, 0, 0.5, 0)
    mainText.Position = UDim2.new(0, 0, 0, 0)
    mainText.BackgroundTransparency = 1
    mainText.Text = "Auto Farm Chest"
    mainText.TextColor3 = Color3.fromRGB(255, 255, 255)
    mainText.TextSize = 48
    mainText.Font = Enum.Font.GothamBold
    mainText.TextTransparency = 1 -- B·∫Øt ƒë·∫ßu trong su·ªët
    mainText.AnchorPoint = Vector2.new(0, 0)
    mainText.TextXAlignment = Enum.TextXAlignment.Center
    mainText.TextYAlignment = Enum.TextYAlignment.Center
    
    -- Credit text
    local creditText = Instance.new("TextLabel")
    creditText.Name = "CreditText"
    creditText.Parent = container
    creditText.Size = UDim2.new(1, 0, 0.3, 0)
    creditText.Position = UDim2.new(0, 0, 0.6, 0)
    creditText.BackgroundTransparency = 1
    creditText.Text = "made by VuongDacThong"
    creditText.TextColor3 = Color3.fromRGB(200, 200, 200)
    creditText.TextSize = 24
    creditText.Font = Enum.Font.Gotham
    creditText.TextTransparency = 1 -- B·∫Øt ƒë·∫ßu trong su·ªët
    creditText.AnchorPoint = Vector2.new(0, 0)
    creditText.TextXAlignment = Enum.TextXAlignment.Center
    creditText.TextYAlignment = Enum.TextYAlignment.Center
    
    -- Add gradient effect to background
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 0, 100)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 50, 150)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 0, 100))
    })
    gradient.Rotation = 0 -- B·∫Øt ƒë·∫ßu t·ª´ 0
    gradient.Parent = background
    
    -- Add corner radius to background
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = background
    
    -- ===== B·∫ÆT ƒê·∫¶U ANIMATIONS =====
    
    -- 1. FADE IN EFFECT (Ch·∫°y ngay l·∫≠p t·ª©c)
    local fadeInfo = TweenInfo.new(
        1.5, -- Time d√†i h∆°n ƒë·ªÉ th·∫•y r√µ
        Enum.EasingStyle.Quad,
        Enum.EasingDirection.Out
    )
    
    local fadeBg = TweenService:Create(background, fadeInfo, {BackgroundTransparency = 0.3})
    local fadeMain = TweenService:Create(mainText, fadeInfo, {TextTransparency = 0})
    local fadeCredit = TweenService:Create(creditText, fadeInfo, {TextTransparency = 0})
    
    fadeBg:Play()
    fadeMain:Play()
    fadeCredit:Play()
    
    -- 2. GRADIENT ROTATION ANIMATION (Xoay li√™n t·ª•c)
    task.wait(0.5) -- ƒê·ª£i fade in m·ªôt ch√∫t
    
    local rotationInfo = TweenInfo.new(
        3, -- Th·ªùi gian xoay 1 v√≤ng (3 gi√¢y)
        Enum.EasingStyle.Linear,
        Enum.EasingDirection.InOut,
        -1, -- L·∫∑p v√¥ h·∫°n
        false -- Kh√¥ng reverse
    )
    
    local rotationTween = TweenService:Create(gradient, rotationInfo, {
        Rotation = 360
    })
    rotationTween:Play()
    
    -- 3. TEXT PULSE ANIMATION (Hi·ªáu ·ª©ng nh·∫•p nh√°y nh·∫π)
    task.spawn(function()
        task.wait(1.5) -- ƒê·ª£i fade in xong
        while mainText and mainText.Parent do
            local pulseInfo = TweenInfo.new(
                1.5,
                Enum.EasingStyle.Sine,
                Enum.EasingDirection.InOut
            )
            
            local pulseOut = TweenService:Create(mainText, pulseInfo, {
                TextColor3 = Color3.fromRGB(200, 200, 255)
            })
            pulseOut:Play()
            pulseOut.Completed:Wait()
            
            local pulseIn = TweenService:Create(mainText, pulseInfo, {
                TextColor3 = Color3.fromRGB(255, 255, 255)
            })
            pulseIn:Play()
            pulseIn.Completed:Wait()
        end
    end)
    
    -- 4. BACKGROUND COLOR SHIFT (ƒê·ªïi m√†u nh·∫π)
    task.spawn(function()
        task.wait(2)
        while background and background.Parent do
            local colorInfo = TweenInfo.new(
                4,
                Enum.EasingStyle.Sine,
                Enum.EasingDirection.InOut
            )
            
            local colorShift = TweenService:Create(background, colorInfo, {
                BackgroundColor3 = Color3.fromRGB(10, 10, 20)
            })
            colorShift:Play()
            colorShift.Completed:Wait()
            
            local colorReturn = TweenService:Create(background, colorInfo, {
                BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            })
            colorReturn:Play()
            colorReturn.Completed:Wait()
        end
    end)
    
    print("‚úÖ GUI Created with ALL animations!")
    return gui, mainText
end

-- Chest detection and sorting
local UncheckedChests, FirstRun = {}, true
local function getChestsSorted()
    if FirstRun then
        FirstRun = false
        for _, Object in pairs(game:GetDescendants()) do
            if Object.Name:find("Chest") and Object.ClassName == "Part" then
                table.insert(UncheckedChests, Object)
            end
        end
    end
    local Chests = {}
    for _, Chest in pairs(UncheckedChests) do
        if Chest:FindFirstChild("TouchInterest") then
            table.insert(Chests, Chest)
        end
    end
    
    -- Sort by distance
    pcall(function()
        local RootPart = getCharacter().HumanoidRootPart
        table.sort(Chests, function(ChestA, ChestB)
            local RootPos = RootPart.Position
            local DistanceA = (RootPos - ChestA.Position).Magnitude
            local DistanceB = (RootPos - ChestB.Position).Magnitude
            return DistanceA < DistanceB
        end)
    end)
    
    return Chests
end

-- Noclip toggle
local function toggleNoclip(Toggle)
    pcall(function()
        for _, v in pairs(getCharacter():GetChildren()) do
            if v:IsA("BasePart") then
                v.CanCollide = not Toggle
            end
        end
    end)
end

-- Teleport function
local function Teleport(Goal)
    pcall(function()
        local RootPart = getCharacter().HumanoidRootPart
        toggleNoclip(true)
        RootPart.CFrame = Goal + Vector3.new(0, 3, 0)
        toggleNoclip(false)
    end)
end

-- Main farm loop
local function startFarm()
    task.spawn(function()
        while task.wait(0.1) do
            pcall(function()
                local Chests = getChestsSorted()
                if #Chests > 0 then
                    Teleport(Chests[1].CFrame)
                end
            end)
        end
    end)
end

-- Auto set team to Marines
task.spawn(function()
    while task.wait(5) do
        pcall(function()
            ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam","Marines")
        end)
    end
end)

-- Character added handler
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    pcall(startFarm)
end)

-- Initialize
print("üöÄ Starting Chest Farm Script...")
local success, err = pcall(function()
    createGui()
    startFarm()
end)

if success then
    print("‚úÖ Script loaded successfully!")
else
    warn("‚ùå Error:", err)
end
